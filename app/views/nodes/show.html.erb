<div class="panel">
  <div class="panel-heading">Node: <%= @node %></div>

  <div class="btn-toolbar">
    <%= link_to "Back", nodes_path, :class => 'btn btn-sm btn-default' %>
    <%= link_to "Edit", edit_node_path(@node), :class => 'btn btn-sm btn-primary' %>
    <%= link_to "Facts", facts_node_path(@node), :class => 'btn btn-sm btn-primary' %>
    <%= link_to "Resources", resources_node_path(@node), :class => 'btn btn-sm btn-primary' %>
    <%= link_to "Delete", @node, :method => :delete, :confirm => "Are you sure?", :class => 'btn btn-sm btn-danger pull-right' %>
  </div>

  <h4>Parameters</h4>
  <table class="table table-bordered table-condensed table-striped">
    <tr>
      <th>Key</th>
      <th>Value</th>
      <th>Source</th>
    </tr>
  <% @node.parameters.each do |parameter| %>
    <tr>
      <td><%= parameter.key %></td>
      <td><%= parameter.value %></td>
      <td><%= @node %></td>
    </tr>
  <% end %>
  <% @node.node_groups.each do |group| %>
    <% group.parameters.each do |parameter| %>
      <tr>
        <td><%= parameter.key %></td>
        <td><%= parameter.value %></td>
        <td><%= link_to group, group %></td>
      </tr>
    <% end %>
  <% end %>
  </table>

  <div class="row">
    <div class="col-lg-6">
      <h4>Groups</h4>
      <table class="table table-bordered table-condensed table-striped">
        <tr>
          <th>Group</th>
          <th>Source</th>
        </tr>
      <% @node.node_groups.each do |node_group| %>
        <tr>
          <td><%= link_to node_group, node_group %></td>
          <td><%= @node %></td>
        </tr>
      <% end %>
      </table>
    </div>
    <div class="col-lg-6">
      <h4>Classes</h4>
      <table class="table table-bordered table-condensed table-striped">
        <tr>
          <th>Class</th>
          <th>Source</th>
        </tr>
      <% @node.node_classes.each do |node_class| %>
        <tr>
          <td><%= link_to node_class, node_class %></td>
          <td><%= @node %></td>
        </tr>
      <% end %>
      </table>
    </div>
  </div>

  <div class="row">
    <div class="col-6">
      <h4>Status over last 24 hours</h4>
      <%= pie_chart @node.reports.where("time > '#{Time.now - 60*60*24}'").group(:status).count %>
    </div>
    <div class="col-6">
      <h4>Run time by resource type</h4>
      <%= pie_chart @node.reports.first.metrics.where(:category => "Time").reject {|n| n.name == "Total"}.collect {|n| [n.name, n.value]} %>
    </div>
  </div>

  <h4>Recent reports (<%= @node.reports.count %>)</h4>

  <table class="table table-bordered table-condensed table-striped">
    <tr>
      <th>Reported at</th>
      <th>Environment</th>
      <th>Status</th>
    </tr>
    <% @node.reports.limit(10).each do |report| %>
      <tr>
        <td><%= link_to node_report_time(report.time), report %></td>
        <td><%= report.environment %></td>
        <td><%= node_status_badge(report) %></td>
      </tr>
    <% end %>
  </table>
</div>
